<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kino & Shorts MiniApp</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * { box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #131927, #2082c6 60%);
            color: #edf2fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
        }
        body.dark-mode {
            background: linear-gradient(135deg, #000001, #0a1a2e 60%);
        }
        /* HEADER */
        .header {
            background: linear-gradient(90deg, #0a143a, #1a3a52);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .header-title {
            font-weight: bold;
            font-size: 1.4rem;
            letter-spacing: .05em;
        }
        .header-icons {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        .header-btn {
            background: #1a233a;
            color: #b9d6f9;
            border: none;
            border-radius: 5px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 1.2em;
            transition: 0.3s;
        }
        .header-btn:hover {
            background: #2082c6;
            color: #fff;
        }
        .admin-badge-small {
            background: #ff6b00;
            color: #fff;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        /* SETTINGS MODAL */
        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .settings-modal.show {
            display: flex;
        }
        .settings-content {
            background: #26335b;
            padding: 20px;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .settings-content h2 {
            color: #18a0f2;
            margin-top: 0;
        }
        .settings-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #1a233a;
        }
        .settings-item label {
            display: block;
            color: #b9d6f9;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .settings-item select, .settings-item input {
            width: 100%;
            padding: 8px;
            border: none;
            border-radius: 5px;
            font-size: 1em;
        }
        .theme-options {
            display: flex;
            gap: 10px;
        }
        .theme-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #1a233a;
            background: #192c47;
            color: #b9d6f9;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
        }
        .theme-btn.active {
            border-color: #1ec0ff;
            background: #2082c6;
            color: #fff;
        }
        .close-settings {
            background: #1ec0ff;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin-top: 15px;
        }
        .tabs {
            text-align: center;
            margin-bottom: 15px;
            overflow-x: auto;
            white-space: nowrap;
            padding: 0 10px;
        }
        .tab-btn {
            background: #192c47;
            color: #b9d6f9;
            border: none;
            border-radius: .4rem;
            margin: 0 4px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.9rem;
            outline:none;
            display: inline-block;
        }
        .tab-btn.active {
            background: #2082c6;
            color: #fff;
            font-weight: bold;
        }
        .container {
            max-width: 600px;
            margin: 0 auto 2rem;
        }
        .card {
            background: #21284a;
            margin-bottom: 1.2rem;
            padding: 1rem;
            border-radius: 0.8rem;
            box-shadow: 0 2px 8px rgba(33,40,74,0.16);
        }
        .card-title {
            color: #18a0f2;
            font-size: 1.1rem;
            margin-bottom: .3rem;
        }
        .card-video { 
            width: 100%; 
            border-radius: .6rem; 
            margin-bottom: .6rem; 
            max-height:280px; 
            background:#000;
        }
        .stats { 
            color: #a3bdd7; 
            font-size: .9rem; 
            margin-bottom:.5rem;
        }
        .likebar {
            display:flex;
            gap:10px;
            align-items:center;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .likebtn, .dislikebtn {
            border:none;
            border-radius:5px;
            padding:4px 10px;
            font-size:1em;
            background:#182040;
            color:#77dbff;
            cursor:pointer;
            transition:.22s;
        }
        .likebtn.liked, .dislikebtn.liked {
            background:#18a0f2;
            color:#fff;
        }
        .comment-section {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #1a233a;
        }
        .comment-input {
            width: 95%;
            padding: 6px;
            border: none;
            border-radius: 5px;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        .comment-btn {
            background: #1ec0ff;
            color: #000;
            border: none;
            border-radius: 5px;
            padding: 5px 12px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
        }
        .comments-list {
            margin-top: 8px;
            max-height: 150px;
            overflow-y: auto;
        }
        .comment {
            background: #192c47;
            padding: 6px;
            margin-bottom: 5px;
            border-radius: 4px;
            font-size: 0.85rem;
            color: #b9d6f9;
        }
        .upload-btn {
            display: block;
            background: linear-gradient(90deg,#1479c9,#1ec0ff 100%);
            color: #fff;
            font-weight: bold;
            border: none;
            border-radius: .6rem;
            margin:15px auto;
            padding: 12px 24px;
            font-size: 1rem;
            cursor: pointer;
            box-shadow:0 2px 8px #1ec0ff44;
        }
        .upldform { 
            max-width:400px; 
            margin:0 auto 2rem; 
            padding:15px; 
            background:#26335b; 
            border-radius:10px;
        }
        .upldform input, .upldform textarea, .upldform select {
            width:96%;
            margin-bottom:10px;
            padding:8px;
            border:none;
            border-radius:5px;
            font-size:0.95em;
        }
        .upldform label{
            font-size:0.9em;
            color: #b9d6f9;
        }
        .admin-badge {
            background: #ff6b00;
            color: #fff;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 0.75rem;
            margin-top: 5px;
            display: inline-block;
        }
        @media (max-width: 700px) {
            .container {max-width:100vw;}
            .card {padding:.8rem;}
            .upldform {padding:10px;}
            .header {font-size: 1.2rem; padding: 0.8rem;}
            .tab-btn {padding: 6px 12px; font-size: 0.8rem;}
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <div class="header">
        <div class="header-title">Kino & Shorts</div>
        <div class="header-icons">
            <span id="admin-indicator"></span>
            <button class="header-btn" onclick="openSettings()" title="Sozlamalar">‚öôÔ∏è</button>
            <button class="header-btn" onclick="checkAdmin()" title="Admin">üë§</button>
        </div>
    </div>

    <!-- SETTINGS MODAL -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <h2>Sozlamalar</h2>
            
            <div class="settings-item">
                <label>Tema:</label>
                <div class="theme-options">
                    <button class="theme-btn active" id="theme-blue" onclick="setTheme('blue')">Dark Blue</button>
                    <button class="theme-btn" id="theme-dark" onclick="setTheme('dark')">Dark</button>
                </div>
            </div>

            <div class="settings-item">
                <label>Video sifati:</label>
                <select id="video-quality">
                    <option value="hd">HD 1080p</option>
                    <option value="sd" selected>SD 480p</option>
                    <option value="ld">LD 240p</option>
                </select>
            </div>

            <div class="settings-item">
                <label>Til (Language):</label>
                <select id="language">
                    <option value="uz" selected>O'zbek</option>
                    <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                    <option value="en">English</option>
                </select>
            </div>

            <div class="settings-item">
                <label>Notifikatsiyalar:</label>
                <input type="checkbox" id="notifications" checked> <span>Yangi videolar haqida xabar ol</span>
            </div>

            <div class="settings-item">
                <label>Kommentlar:</label>
                <input type="checkbox" id="show-comments" checked> <span>Kommentlarni ko'rsat</span>
            </div>

            <button class="close-settings" onclick="closeSettings()">Yopish</button>
        </div>
    </div>

    <!-- TABS -->
    <div class="tabs">
        <button class="tab-btn active" id="tab-cinema" onclick="showTab('cinema')">Kino</button>
        <button class="tab-btn" id="tab-shorts" onclick="showTab('shorts')">Shorts</button>
        <button class="tab-btn" id="tab-upload" onclick="showTab('upload')" style="display: none;">Yuklash</button>
        <button class="tab-btn" id="tab-top" onclick="showTab('top')">TOP</button>
    </div>
    <div class="container" id="content"></div>

    <script>
        // Admin ID ‚Äî SAMXOJI ga o'zgartirildi
        const ADMIN_ID = "Samxoji";
        let currentUser = localStorage.getItem("userId") || "user_" + Math.floor(Math.random() * 100000);
        localStorage.setItem("userId", currentUser);
        let isAdmin = localStorage.getItem("isAdmin") === "true";

        // Settings
        let theme = localStorage.getItem("theme") || "blue";
        let videoQuality = localStorage.getItem("videoQuality") || "sd";
        let language = localStorage.getItem("language") || "uz";
        let showComments = localStorage.getItem("showComments") !== "false";

        // Demo data
        let videos = {
            "cinema": [
                {id:1, title:"O'zbek filmi", url:"https://samplelib.com/mp4/sample-5s.mp4", views:120, likes:17, dislikes:2, comments:[{user:"User1", text:"Ajoyib film!"}]},
                {id:2, title:"Komediya", url:"https://samplelib.com/mp4/sample-10s.mp4", views:88, likes:9, dislikes:1, comments:[]}
            ],
            "shorts": [
                {id:3, title:"Qiziqarli short", url:"https://samplelib.com/mp4/sample-3s.mp4", views:44, likes:7, dislikes:0, comments:[]}
            ]
        };

        // Initialize
        if (isAdmin) {
            document.getElementById("upload-tab").style.display = "inline-block";
            document.getElementById("admin-indicator").innerHTML = `<span class="admin-badge-small">ADMIN</span>`;
        }
        applyTheme(theme);

        const getLikeStatus = (type, id) => localStorage.getItem(`like_${type}_${id}`) || "";
        const setLikeStatus = (type, id, val) => localStorage.setItem(`like_${type}_${id}`, val);

        // SETTINGS
        function openSettings() {
            document.getElementById("settingsModal").classList.add("show");
        }
        function closeSettings() {
            document.getElementById("settingsModal").classList.remove("show");
        }
        function setTheme(t) {
            theme = t;
            localStorage.setItem("theme", t);
            applyTheme(t);
            document.getElementById("theme-blue").classList.toggle("active", t === "blue");
            document.getElementById("theme-dark").classList.toggle("active", t === "dark");
        }
        function applyTheme(t) {
            if (t === "dark") {
                document.body.classList.add("dark-mode");
            } else {
                document.body.classList.remove("dark-mode");
            }
        }

        // ADMIN
        function checkAdmin() {
            let pwd = prompt("Admin parolini kiriting:");
            if (pwd === ADMIN_ID) {
                isAdmin = true;
                localStorage.setItem("isAdmin", "true");
                document.getElementById("upload-tab").style.display = "inline-block";
                document.getElementById("admin-indicator").innerHTML = `<span class="admin-badge-small">ADMIN</span>`;
                alert("‚úÖ Admin mode ON!");
                location.reload();
            } else if (pwd !== null) {
                alert("‚ùå Parol xato!");
            }
        }

        // TABS
        function showTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(el=>el.classList.remove('active'));
            document.getElementById('tab-'+tab).classList.add('active');
            if(tab==='cinema') renderList('cinema');
            if(tab==='shorts') renderList('shorts');
            if(tab==='upload') renderUpload();
            if(tab==='top') renderTop();
        }

        // RENDER LIST
        function renderList(type){
            let html = ``;
            if (isAdmin) {
                html += `<button class="upload-btn" onclick="showTab('upload')">+ Video yuklash</button>`;
            }
            videos[type].forEach(v=>{
                html += `
                  <div class="card">
                    <div class="card-title">${v.title}`;
                if (isAdmin) html += ` <span class="admin-badge">ADMIN</span>`;
                html += `</div>
                    <video class="card-video" controls src="${v.url}"></video>
                    <div class="stats">üëÅÔ∏è ${v.views} ko'rilgan</div>
                    <div class="likebar">
                        <button class="likebtn ${getLikeStatus(type,v.id)=='like'?'liked':''}" onclick="likeVideo('${type}',${v.id})">üëç ${v.likes}</button>
                        <button class="dislikebtn ${getLikeStatus(type,v.id)=='dislike'?'liked':''}" onclick="dislikeVideo('${type}',${v.id})">üëé ${v.dislikes}</button>
                        <span style="flex: 1;"></span>
                        <button style="background: #192c47; color: #77dbff; border: none; border-radius: 5px; padding: 4px 10px; cursor: pointer;" onclick="shareVideo('${v.title}')">üì§ Ulashish</button>
                    </div>`;
                if (showComments) {
                    html += `
                    <div class="comment-section">
                        <input type="text" class="comment-input" id="comment_${v.id}" placeholder="Komment yozing...">
                        <button class="comment-btn" onclick="addComment('${type}', ${v.id})">Yuborish</button>
                        <div class="comments-list" id="comments_${v.id}">`;
                    if (v.comments && v.comments.length > 0) {
                        v.comments.forEach(c => {
                            html += `<div class="comment"><b>${c.user}</b>: ${c.text}</div>`;
                        });
                    }
                    html += `</div>
                    </div>`;
                }
                html += `</div>`;
            });
            document.getElementById('content').innerHTML = html;
        }

        // LIKE/DISLIKE
        function likeVideo(type, id) {
            if(getLikeStatus(type,id)==='like') return;
            let v = videos[type].find(x=>x.id===id); 
            v.likes++;
            v.views++;
            setLikeStatus(type, id, 'like');
            showTab(type);
        }
        function dislikeVideo(type, id) {
            if(getLikeStatus(type,id)==='dislike') return;
            let v = videos[type].find(x=>x.id===id); 
            v.dislikes++;
            v.views++;
            setLikeStatus(type, id, 'dislike');
            showTab(type);
        }

        // COMMENTS
        function addComment(type, id) {
            let txt = document.getElementById(`comment_${id}`).value;
            if (!txt.trim()) return;
            let v = videos[type].find(x=>x.id===id);
            if (!v.comments) v.comments = [];
            v.comments.push({user: currentUser.substring(0,10), text: txt});
            document.getElementById(`comment_${id}`).value = "";
            showTab(type);
        }

        // SHARE
        function shareVideo(title) {
            alert(`üì§ "${title}" ulashildi!`);
        }

        // UPLOAD
        function renderUpload() {
            if (!isAdmin) {
                document.getElementById('content').innerHTML = `<p style="text-align:center; color: red;">‚ùå Siz admin emassiz!</p>`;
                return;
            }
            let html = `
                <form class="upldform" onsubmit="event.preventDefault();uploadVideo()">
                    <label>üìù Video nomi:</label><br>
                    <input type="text" id="v_title" required><br>
                    <label>üîó Video URL (mp4):</label><br>
                    <input type="url" id="v_url" required placeholder="https://...mp4"><br>
                    <label>üé¨ Bo'lim:</label><br>
                    <select id="v_type">
                        <option value="cinema">Kino</option>
                        <option value="shorts">Shorts</option>
                    </select><br>
                    <button type="submit" class="upload-btn">‚úÖ Yuklash</button>
                </form>
            `;
            document.getElementById('content').innerHTML = html;
        }

        function uploadVideo() {
            let t = document.getElementById('v_title').value;
            let u = document.getElementById('v_url').value;
            let tp = document.getElementById('v_type').value;
            videos[tp].push({id: Date.now(), title:t, url:u, views:1, likes:0, dislikes:0, comments:[]});
            alert("‚úÖ Video yuklandi!");
            showTab(tp);
        }

        // TOP
        function renderTop() {
            let all = [...videos.cinema, ...videos.shorts].sort((a,b)=>b.views-a.views);
            let html = `<h2 style="text-align:center; color: #18a0f2;">üî• TOP ko'rilganlar</h2>`;
            all.slice(0,6).forEach((v, idx)=>{
                html += `
                  <div class="card">
                    <div class="card-title">#${idx+1} ${v.title}</div>
                    <video class="card-video" controls src="${v.url}"></video>
                    <div class="stats">üëÅÔ∏è ${v.views} ko'rilgan | üëç ${v.likes}</div>
                  </div>
                `;
            });
            document.getElementById('content').innerHTML = html;
        }

        showTab('cinema');
    </script>
</body>
</html>
